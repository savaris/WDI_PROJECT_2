"use strict";var App=App||{},google=google;App.init=function(){App.mapSetup(),this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.mapMarkers=[],$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),$("#map-canvas").show(),App.getWebcams()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.register()},App.register=function(e){e&&e.preventDefault(),this.$main.html("<div class='modal fade' tabindex='-1' role='dialog'>\n  <div class='modal-dialog' role='document'>\n  <div class='modal-content'>\n  <div class='modal-body'>\n  <h2>Register</h2>\n  <form method='post' action='/register'>\n  <div class='form-group'>\n  <input class='form-control-register' type='text' name='user[username]' placeholder='Username'>\n  </div>\n  <div class='form-group'>\n  <input class='form-control-register' type='email' name='user[email]' placeholder='Email'>\n  </div>\n  <div class='form-group'>\n  <input class='form-control-register' type='password' name='user[password]' placeholder='Password'>\n  </div>\n  <div class='form-group'>\n  <input class='form-control-register' type='password' name='user[passwordConfirmation]' placeholder='Password Confirmation'>\n  </div>\n  <input class='btn btn-primary' type='submit' value='Register'>\n  </form>\n  </div>\n  </div>\n  </div>\n  </div>\n  "),$(".modal").modal("show")},App.login=function(e){e&&e.preventDefault(),this.$main.html("\n    <div class='modal fade' tabindex='-1' role='dialog'>\n    <div class='modal-dialog' role='document'>\n    <div class='modal-content'>\n    <div class='modal-body'>\n    <h2>Login</h2>\n    <form method='post' action='/login'>\n    <div class='form-group'>\n    <input class='form-control-login' type='email' name='email' placeholder='Email'>\n    </div>\n    <div class='form-group'>\n    <input class='form-control-login' type='password' name='password' placeholder='Password'>\n    </div>\n    <input class='btn btn-primary' type='submit' value='Login'>\n    </form>\n    </div>\n    </div>\n    </div>\n    </div>\n    "),$(".modal").modal("show")},App.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(e){e.preventDefault();var t=""+App.apiUrl+$(this).attr("action"),a=$(this).attr("method"),o=$(this).serialize();return App.ajaxRequest(t,a,o,function(e){e.token&&($(".fade").fadeOut(),App.setToken(e.token),App.loggedInState())})},App.ajaxRequest=function(e,t,a,o,n){return $.ajax({url:e,method:t,data:a,beforeSend:n?n:this.setRequestHeader.bind(this)}).done(o).fail(function(e){console.log(e)})},App.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer       "+this.getToken())},App.setApiToken=function(e){return e.setRequestHeader("X-Mashape-Key","5N1IqU0Ln5msh2kJB8FNMmu9Ahdrp1BpIWkjsntkQAspOznbn1")},App.setToken=function(e){return window.localStorage.setItem("token",e)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},App.addInfoWindowForWebcam=function(e,t){google.maps.event.addListener(t,"click",function(){$(".modal").show(),$(".modal-body").html("\n      <ul class='nav nav-tabs'>\n          <li class='nav-item active'>\n            <a href='#camera' aria-controls='camera' data-toggle='tab'>View Camera</a>\n          </li>\n          <li class='nav-item'>\n            <a href='#details' aria-controls='details' data-toggle='tab'>Details</a>\n          </li>\n          <li class='nav-item'>\n            <a href='#weather' aria-controls='weather' data-toggle='tab'>Weather</a>\n          </li>\n      </ul>\n\n      <div class='tab-content'>\n        <div role='tabpanel' class='tab-pane active' id='camera'>\n        <iframe src='"+e.timelapse.month.embed+"?autoplay=1' width='480px' height='340px' allowfullscreen></iframe>\n      </div>\n      <div role='tabpanel' class='tab-pane' id='details'>\n        <p>"+e.title+"</p>\n        <p>"+e.location.country+"</p>\n        <p>"+e.location.city+"</p>\n        <p>"+e.location.region+"</p>\n      </div>\n        <div role='tabpanel' class='tab-pane' id='weather'>\n        <iframe width='100%' frameBorder='0' style='height: 50vh; margin: 25px 0;' src='https://maps.darksky.net/@temperature,"+e.location.latitude+","+e.location.longitude+",10?embed=true&timeControl=true&fieldControl=true&defaultField=temperature&defaultUnits=_c'></iframe>\n      </div>\n    </div>\n        "),$(".modal").modal("show")})},App.toggleBounce=function(e){var t=this;google.maps.event.addListener(e,"click",function(){$.each(t.mapMarkers,function(e,t){t.setAnimation(null)}),e.setAnimation(google.maps.Animation.BOUNCE)})},App.createMarkerForWebcam=function(e){var t=new google.maps.LatLng(e.location.latitude,e.location.longitude),a=new google.maps.Marker({position:t,map:this.map,icon:"/images/icon.jpg",animation:google.maps.Animation.DROP});this.mapMarkers.push(a),this.toggleBounce(a),this.addInfoWindowForWebcam(e,a)},App.loopThroughWebcams=function(e){$.each(e.result.webcams,function(e,t){setTimeout(function(){App.createMarkerForWebcam(t)},400*e)})},App.getWebcams=function(){App.ajaxRequest("https://webcamstravel.p.mashape.com/webcams/list/continent=EU/property=hd/orderby=views/limit=2,?show=webcams:location,url,timelapse","GET",null,this.loopThroughWebcams,App.setApiToken)},App.mapSetup=function(){console.log("building map");var e=document.getElementById("map-canvas"),t={zoom:7,center:new google.maps.LatLng(46.934003,8.129233),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"geometry.fill",stylers:[{weight:"2.00"}]},{featureType:"all",elementType:"geometry.stroke",stylers:[{color:"#9c9c9c"}]},{featureType:"all",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#eeeeee"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#7b7b7b"}]},{featureType:"road",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#c8d7d4"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#070707"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"}]}]};App.map=new google.maps.Map(e,t)},$(App.init.bind(App));